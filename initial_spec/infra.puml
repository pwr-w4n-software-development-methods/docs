@startuml
!define EXTERNAL_COLOR #ECEFF1
!define OUR_COLOR #E8F5E9
!define TEACHER_SITES_COLOR #FFF9C4
!define EXTERNAL_SITES_COLOR #FFCCBC

skinparam linetype ortho
skinparam rectangle {
    BackgroundColor<<external>> EXTERNAL_COLOR
    BackgroundColor<<ours>> OUR_COLOR
    BackgroundColor<<mcp>> #FFF3E0
    BackgroundColor<<tool>> #F3E5F5
    BackgroundColor<<wrapper>> #E8F5E9
    BackgroundColor<<bridge>> #FCE4EC
}

package "Zewnętrzne - AI Agent" <<external>> {
    rectangle "AI Agent\n(Zewnętrzny)" <<external>> {
        component "Rdzeń AI Agent"
    }
}

rectangle "Nasza Infrastruktura" <<ours>> {
    rectangle "Serwer MCP" <<mcp>> {
        rectangle "Narzędzia MCP Stron Prowadzących" <<tool>> {
            component "Narzędzie Strony 1"
            component "Narzędzie Strony 2"
            component "Narzędzie Strony N"
        }
        rectangle "Narzędzia MCP USOS" <<tool>> {
            component "Narzędzie USOS 1"
            component "Narzędzie USOS 2"
            component "Narzędzie USOS N"
        }
    }

    rectangle "Warstwa Integracji" <<wrapper>> {

        rectangle "Integracja USOS" <<wrapper>> {
            rectangle "Wrapper API USOS" {
                component "Logika Wrappera API"
            }

            rectangle "Most USOS" <<bridge>> {
                component "Handler Uwierzytelniania Web"
                component "Komunikacja API"
            }
        }
        rectangle "Parser Stron Prowadzących" <<bridge>> {
            component "Logika Parsera"
        }

    }
}

package "Zewnętrzne - Strony Prowadzących" TEACHER_SITES_COLOR {
    rectangle "Strona Prowadzącego A" TEACHER_SITES_COLOR {
        component "Strona A"
    }
    rectangle "Strona Prowadzącego B" TEACHER_SITES_COLOR {
        component "Strona B"
    }
    rectangle "Strona Prowadzącego N" TEACHER_SITES_COLOR {
        component "Strona N"
    }
}

package "Zewnętrzne - Infrastruktura USOS" EXTERNAL_SITES_COLOR {
    rectangle "Web USOS\n(Uwierzytelnianie)" <<external>> {
        component "Portal Web USOS"
    }

    rectangle "Serwery USOS" <<external>> {
        component "API USOS"
    }
}

"Rdzeń AI Agent" --> "Narzędzie Strony 1" : używa
"Rdzeń AI Agent" --> "Narzędzie Strony 2" : używa
"Rdzeń AI Agent" --> "Narzędzie Strony N" : używa
"Rdzeń AI Agent" --> "Narzędzie USOS 1" : używa
"Rdzeń AI Agent" --> "Narzędzie USOS 2" : używa
"Rdzeń AI Agent" --> "Narzędzie USOS N" : używa

"Narzędzie Strony 1" --> "Logika Parsera" : wywołuje
"Narzędzie Strony 2" --> "Logika Parsera" : wywołuje
"Narzędzie Strony N" --> "Logika Parsera" : wywołuje

"Logika Parsera" --> "Strona A" : scrapuje
"Logika Parsera" --> "Strona B" : scrapuje
"Logika Parsera" --> "Strona N" : scrapuje

"Narzędzie USOS 1" --> "Logika Wrappera API" : wywołuje
"Narzędzie USOS 2" --> "Logika Wrappera API" : wywołuje
"Narzędzie USOS N" --> "Logika Wrappera API" : wywołuje

"Logika Wrappera API" --> "Handler Uwierzytelniania Web" : deleguje

"Handler Uwierzytelniania Web" --> "Portal Web USOS" : uwierzytelnia
"Portal Web USOS" --> "Handler Uwierzytelniania Web" : zwraca poświadczenia

"Handler Uwierzytelniania Web" --> "Komunikacja API" : dostarcza uwierzytelnianie

"Komunikacja API" --> "API USOS" : HTTP żądania\n(z uwierzytelnianiem)
"API USOS" --> "Komunikacja API" : HTTP odpowiedzi

@enduml
